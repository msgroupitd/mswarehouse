<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Склад Master Service</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: sans-serif;
        transition: background-color 0.3s, color 0.3s;
      }

      .container {
        display: flex;
        align-items: center;
        gap: 16px;
        background: rgba(0,0,0,0.05);
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }

      .avatar {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        object-fit: cover;
        background: #ccc;
      }

      .user-info {
        display: flex;
        flex-direction: column;
      }

      .name {
        font-size: 1.2em;
        font-weight: bold;
      }

      .username {
        color: gray;
      }

      .dark {
        background-color: #1c1c1e;
        color: #fff;
      }

      .dark .container {
        background: rgba(255,255,255,0.05);
        box-shadow: 0 4px 12px rgba(255,255,255,0.1);
      }

      .dark .username {
        color: #aaa;
      }
    </style>
  </head>
  <body>
    <h2>Правила для использования данного Бота.</h2>
    <p>1. Ваше Фамилия и Имя должны соотвествоввать реальным чтобы сотрудник склада мог понять кто ему пишет.</p>

    <div class="container">
      <img class="avatar" id="avatar" alt="avatar" />
      <div class="user-info">
        <div class="name" id="name"></div>
        <div class="username" id="username"></div>
      </div>
    </div>

    <script type="text/javascript">
      window.onload = function () {
        Telegram.WebApp.ready();
        const user = Telegram.WebApp.initDataUnsafe.user;

        if (!user) {
          console.error("Не удалось получить данные пользователя.");
          return;
        }

        const fullName = user.first_name + (user.last_name ? ' ' + user.last_name : '');
        const username = user.username ? '@' + user.username : '';
        const userId = user.username || user.id;

        // Показать имя и username
        document.getElementById('name').innerText = fullName;
        document.getElementById('username').innerText = username;

        // Фото пользователя (если есть)
        const avatar = document.getElementById('avatar');
        if (user.photo_url) {
          avatar.src = user.photo_url;
        } else {
          avatar.src = 'https://via.placeholder.com/64?text=?'; // Заглушка
        }

        // Поддержка тёмной темы
        const themeParams = Telegram.WebApp.themeParams;
        if (themeParams.bg_color && getLuminance(themeParams.bg_color) < 128) {
          document.body.classList.add('dark');
        }

        // HelpCrunch
        window.helpcrunchSettings = {
          organization: 'mswarehouse',
          appId: '80c80346-ee88-426b-87cd-0d0719016548',
          user: {
            name: fullName,
            user_id: userId
          }
        };

        (function (w, d) {
          var hS = w.helpcrunchSettings;
          if (!hS || !hS.organization) return;

          var widgetSrc = 'https://embed.helpcrunch.com/sdk.js';
          w.HelpCrunch = function () {
            w.HelpCrunch.q.push(arguments);
          };
          w.HelpCrunch.q = [];

          function r() {
            if (d.querySelector('script[src="' + widgetSrc + '"]')) return;
            var s = d.createElement('script');
            s.async = 1;
            s.type = 'text/javascript';
            s.src = widgetSrc;
            (d.body || d.head).appendChild(s);
          }

          r();
        })(window, document);

        // Вспомогательная функция: яркость цвета
        function getLuminance(hex) {
          const c = hex.replace('#', '');
          const r = parseInt(c.substr(0, 2), 16);
          const g = parseInt(c.substr(2, 2), 16);
          const b = parseInt(c.substr(4, 2), 16);
          return 0.299 * r + 0.587 * g + 0.114 * b;
        }
      };
    </script>
  </body>
</html>
